var link_parts = require('./link_parts');

module.exports = function wiki_links(text, cb) {

    var hits = text.match(/\[\[([^\]]+)\]\]/g);
    if (!cb){
        return hits;
    }

    if (hits && hits.length) {

       var parts = link_parts( _.uniq(hits));

    parts.forEach(function (part) {

            var repl = '<a href="/wiki/a/' + scope + '/' + name + '" class="wikilink">' + title + '</a>';
            text = text.replace(part.original, repl);
        })
    }

    cb(null, text);
}