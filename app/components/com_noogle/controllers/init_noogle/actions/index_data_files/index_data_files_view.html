<form method="post" class="wizard form" xmlns="http://www.w3.org/1999/html"><h1>Initilaize Noogle</h1>
    <%- partial("../../views/step_header.html", {step: "index_data_files"}) %> <br/>

    <h2>Index Data Files</h2>

    <p>
        Pull in a list of content files</p>
    <table border="0" cellpadding="0" cellspacing="0" style="width: 100%; ">
        <tbody>
        <tr>
            <th>
                Scope
            </th>
            <td>
                <label class="radio" style="display: inline-block; width: 12em"><input checked="checked" name="scope"
                                                                                       type="radio" value="1"/>&nbsp;one
                    file</label>
                <label class="radio" style="display: inline-block; width: 12em"><input name="scope" type="radio"
                                                                                       value="10"/>&nbsp;ten
                    files</label>

                <br />

                <label class="radio" style="display: inline-block; width: 12em"><input name="scope" type="radio"
                                                                                       value="100"/>&nbsp;a hundred
                    files</label>
                <label class="radio" style="display: inline-block; width: 12em"><input name="scope" type="radio"
                                                                                       value="1000"/>&nbsp;a thousand
                    files</label>
                <label class="radio" style="display: inline-block; width: 12em"><input name="scope" type="radio"
                                                                                       value="all"/>&nbsp;<b>all</b>
                    files</label>
                <button class="btn btn-primary" onclick="return NOOGLE.load_indexes()">Load Indexes</button>
            </td>
        </tr>
        <tr>
            <td>
                &nbsp;</td>
            <td>
                &nbsp;</td>
        </tr>
        </tbody>
    </table>
    <table class="table" border="0" cellpadding="0" cellspacing="0">
        <thead>
        <tr>
            <th>#</th>
            <th>Date</th>
            <th>File</th>
            <th>Host</th>
            <th>Size</th>
        </tr>
        </thead>
        <tbody id="file_rows">
        </tbody>
    </table>
    <%- partial("../../views/step_footer.html", {step: "index_data_files"}) %>
</form>

<script language="javascript">
    var NOOGLE = {

        load_indexes:function () {

            var wizard_vals = _.reduce($('form.wizard').serializeArray(), function (m, r) {
                m[r.name] = r.value;
                return m;
            }, {});

            console.log(wizard_vals);

            function _with_files(data) {
                try {
                    var j = (typeof data == 'string') ? JSON.parse(data) : data;
                } catch (err) {
                    return console.log('cannot parse ', data);
                }

                var row_ele = $('#file_rows');
                row_ele.empty();
                $.each(j, function (i, file) {
                    row_ele.append('<tr>' +
                            '<th class="right d">' + (i + 1) + '</th>' +
                            '<td class="right">' + file.base + '</td>' +
                            '<td class="right d" nowrap="nowrap">' + file.file + '</td>' +
                            '<td class="right">' + (file.host) + '</td>' +
                            '<td class="right">' + Math.floor(parseInt(file.size)/1024) + ' K</td>' +
                            '</tr>');
                });

            }


            try {

                $.get('/noogle/load_indexes/' + wizard_vals.scope, _with_files);
            } catch (oops) {
                console.log(oops);
            }

            return false;
        }

    }
</script>
<style>
    td.right {
        text-align: right !important;
    }
    .d {
        background-color=rgba(0,0,0,0.1);
    }
</style>